@startuml Lawyer Attestation - Error Handling Flow
<style>
' Professional Light Theme Configuration - Pure CSS Style
!$color_bg = "#ffffff"
!$color_bg_light = "#f8f9fa"
!$color_bg_lighter = "#e9ecef"
!$color_fg = "#212529"
!$color_fg_muted = "#6c757d"
!$color_primary = "#0066cc"
!$color_primary_light = "#4da6ff"
!$color_success = "#28a745"
!$color_warning = "#856404"
!$color_error = "#dc3545"
!$color_accent = "#6f42c1"

' Root document styling
document {
  BackGroundColor: $color_bg;
  FontColor: $color_fg;
  FontName: "Segoe UI", -apple-system, BlinkMacSystemFont, Roboto, "Helvetica Neue", Arial, sans-serif;
  FontSize: 11;
}

' Activity diagram specific styling
activity {
  BackGroundColor: $color_bg_light;
  LineColor: $color_primary;
  FontColor: $color_fg;
  FontSize: 10;
  LineThickness: 2;
  RoundCorner: 8;
  Padding: 8;
}

' Start/End styling
start {
  BackGroundColor: $color_success;
  LineColor: $color_success;
  FontColor: $color_bg;
  FontSize: 10;
}

end {
  BackGroundColor: $color_error;
  LineColor: $color_error;
  FontColor: $color_bg;
  FontSize: 10;
}

' Decision diamond styling  
diamond {
  BackGroundColor: $color_bg_lighter;
  LineColor: $color_warning;
  FontColor: $color_fg;
  FontSize: 9;
  LineThickness: 2;
}

' Arrow styling
arrow {
  LineColor: $color_primary;
  FontColor: $color_fg;
  FontSize: 9;
  LineThickness: 2;
}

' Note styling
note {
  BackGroundColor: $color_bg_lighter;
  LineColor: $color_accent;
  FontColor: $color_fg;
  FontSize: 9;
  LineThickness: 1;
  RoundCorner: 6;
  Padding: 6;
}

' Partition styling
partition {
  BackGroundColor: $color_bg_light;
  LineColor: $color_accent;
  FontColor: $color_fg;
  FontSize: 10;
  LineThickness: 2;
}
</style>

title Lawyer Attestation - Comprehensive Error Handling & Recovery Flow

start

:ğŸ“ User submits\nattestation form;

partition "ğŸ” Frontend Validation Layer" {
  if (Required fields filled?) then (âŒ Missing data)
    :ğŸš¨ Show field validation errors;
    note right
      **Field Validation Errors:**
      â€¢ "Legal name is required"
      â€¢ "Bar number is required"  
      â€¢ "Bar number must be 4-10 characters"
      â€¢ "Please enter valid format"
    end note
    :ğŸ”„ Keep user on form\nwith error highlights;
    stop
  else (âœ… All fields valid)
  endif

  if (All checkboxes confirmed?) then (âŒ Incomplete)
    :âš ï¸ Show attestation errors;
    note right
      **Attestation Errors:**
      â€¢ "All professional confirmations required"
      â€¢ "Must confirm good standing"
      â€¢ "Must acknowledge liability"
    end note
    :ğŸ”„ Return to form\nwith missing items highlighted;
    stop
  else (âœ… All confirmed)
  endif

  if (Bar number format valid?) then (âŒ Invalid format)
    :ğŸ“‹ Show bar number format error;
    note right
      **Bar Number Validation:**
      â€¢ Must be 4-10 alphanumeric characters
      â€¢ Alberta format (AB12345)
      â€¢ No special characters allowed
    end note
    :ğŸ”„ Focus on bar number field;
    stop
  else (âœ… Valid format)
  endif
}

partition "ğŸ” Authentication Layer" {
  if (User authenticated?) then (âŒ Not logged in)
    :ğŸ”’ Save form data to localStorage;
    :â¡ï¸ Redirect to login page;
    note right
      **Authentication Recovery:**
      â€¢ Preserve form data during login
      â€¢ Return to form after successful auth
      â€¢ Show "Session expired" message
      â€¢ Auto-restore form fields
    end note
    :ğŸ”„ After login, restore form\nand show "Please try again";
    stop
  else (âœ… Authenticated)
  endif

  if (User role is lawyer?) then (âŒ Wrong role)
    :ğŸš« Show role restriction error;
    note right
      **Authorization Errors:**
      â€¢ "Only lawyers can submit attestations"
      â€¢ "Please contact support if you are a lawyer"
      â€¢ "Check your profile settings"
    end note
    stop
  else (âœ… Is lawyer)
  endif
}

partition "ğŸ§  Business Logic Layer" {
  if (Data validation passes?) then (âŒ Invalid data)
    :ğŸ“ Show detailed validation errors;
    note right
      **Business Rule Violations:**
      â€¢ "All attestation statements must be true"
      â€¢ "Legal name format invalid"
      â€¢ "Bar number fails checksum validation"
      â€¢ "Professional requirements not met"
    end note
    :ğŸ”„ Return specific field errors;
    stop
  else (âœ… Data valid)
  endif

  if (Existing attestation check?) then (ğŸ”„ Update mode)
    :ğŸ“‹ Show "Updating existing attestation";
  else (ğŸ†• New attestation)
    :ğŸ“‹ Show "Creating new attestation";
  endif
}

partition "ğŸ›ï¸ LSA Verification Layer" {
  if (LSA API available?) then (âŒ Service down)
    :âš ï¸ Show LSA service error;
    note right
      **LSA Service Recovery:**
      â€¢ "Verification service temporarily unavailable"
      â€¢ "Your attestation will be reviewed manually"
      â€¢ "You will be notified when complete"
      â€¢ Save with manual_review flag
    end note
    :ğŸ“‹ Save attestation with\nmanual review flag;
    :ğŸ“§ Queue for manual LSA verification;
    :âœ… Show partial success message;
    end
  else (âœ… LSA available)
  endif

  if (Bar number found in LSA?) then (âŒ Not found)
    :ğŸ›ï¸ Show LSA verification error;
    note right
      **LSA Verification Failures:**
      â€¢ "Bar number not found in LSA directory"
      â€¢ "Please verify your bar number"
      â€¢ "Contact LSA if you believe this is an error"
      â€¢ Provide LSA contact information
    end note
    :ğŸ“ Show LSA contact info\nfor manual resolution;
    stop
  else (âœ… Found in LSA)
  endif

  if (Lawyer in good standing?) then (âŒ Disciplinary issues)
    :âš–ï¸ Show professional standing error;
    note right
      **Professional Standing Issues:**
      â€¢ "Professional standing issues detected"
      â€¢ "Please resolve with LSA before attesting"
      â€¢ "Contact LSA Professional Regulation"
      â€¢ Do not save attestation
    end note
    :ğŸ“ Provide LSA Professional\nRegulation contact;
    stop
  else (âœ… Good standing)
  endif
}

partition "ğŸ’¾ Database Layer" {
  if (Database save successful?) then (âŒ Save failed)
    :ğŸ’¾ Show database error;
    note right
      **Database Recovery:**
      â€¢ "Could not save attestation"
      â€¢ "Please try again in a moment"
      â€¢ Log error details for debugging
      â€¢ Implement exponential backoff retry
    end note
    :ğŸ”„ Auto-retry with backoff;
    if (Retry successful?) then (âœ… Saved)
    else (âŒ Still failing)
      :ğŸ†˜ Show "Contact support" message;
      :ğŸ“§ Auto-create support ticket;
      stop
    endif
  else (âœ… Saved successfully)
  endif

  if (Audit log save successful?) then (âŒ Audit failed)
    :ğŸ“‹ Log audit failure\n(critical for compliance);
    note right
      **Audit Logging Recovery:**
      â€¢ Continue with attestation (data saved)
      â€¢ Log audit failure separately
      â€¢ Queue audit retry in background
      â€¢ Alert compliance team
    end note
    :âš ï¸ Queue audit log retry;
    :ğŸ“§ Alert compliance team;
  else (âœ… Audit logged)
  endif
}

:ğŸ‰ Success! Show confirmation;
:ğŸ“Š Update attestation status;
:âœ‰ï¸ Send confirmation email;

end



@enduml